<!DOCTYPE html>
<html lang="en">
<head>
	<title>three.js webgl - loaders - OBJ loader</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<style>
	body {
		font-family: Monospace;
		background-color: #000;
		color: #fff;
		margin: 0px;
		overflow: hidden;
	}
	#info {
		color: #fff;
		position: absolute;
		top: 10px;
		width: 100%;
		text-align: center;
		z-index: 100;
		display:block;
	}
	#info a, .button { color: #f00; font-weight: bold; text-decoration: underline; cursor: pointer }
	</style>
</head>

<body>
	<div id="info">
		<a href="http://threejs.org" target="_blank">three.js</a> - OBJLoader test
	</div>

	<script src="js/three.min.js"></script>
	<script src="js/loaders/OBJLoader.js"></script>
	<script src="js/loaders/MTLLoader.js"></script>
	<script src="js/loaders/DDSLoader.js"></script>
	<script src="js/controls/FlyControls.js"></script>
	<script src="js/Detector.js"></script>
	<script src="js/libs/stats.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

	<script>

    $.getJSON("example.json", function(nodes) {
        initNodes(nodes);
    });

    function initNodes(nodes)
    {
        nodes.nodes.forEach(function(node){
            var geometry = new THREE.BoxGeometry( 2, 1, 1 );
            var material = new THREE.MeshBasicMaterial( { color: 0xffff00 } );
            var mesh = new THREE.Mesh( geometry, material );
            mesh.position.set(node.position.x, node.position.y, node.position.z);
            scene.add(mesh);
        });
    }

	if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

	var container, stats;

	var camera, controls, scene, renderer;

	var cross;

	var clock = new THREE.Clock();

    var points = [];


	init();
	animate();

	function init() {
		// Create container
		container = document.createElement( 'div' );
		document.body.appendChild( container );
		document.onkeydown = checkKey;

		/*	PerspectiveCamera( fov, aspect, near, far )
		*
		*	fov — Camera frustum vertical field of view.
		*	aspect — Camera frustum aspect ratio.
		*	near — Camera frustum near plane.
		*	far — Camera frustum far plane.
		*/
		camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.1, 10000 );
		camera.position.z = 0;

		// Controls
		controls = new THREE.FlyControls( camera );
		controls.movementSpeed = 100;
		controls.domElement = container;
		controls.rollSpeed = Math.PI / 12;
		controls.autoForward = false;
		controls.dragToLook = true;

		// scene
		scene = new THREE.Scene();

        // Lights
		var ambient = new THREE.AmbientLight( 0xffffff );
		scene.add( ambient );

		var onProgress = function ( xhr ) {
			if ( xhr.lengthComputable ) {
				var percentComplete = xhr.loaded / xhr.total * 100;
				console.log( Math.round(percentComplete, 2) + '% downloaded' );
			}
		};

		var onError = function ( xhr ) {
		};


		var m_name = 'hearc'
		var m_version = 'pathfinding'
		var m_path = m_name + '_' + m_version

		THREE.Loader.Handlers.add( /\.dds$/i, new THREE.DDSLoader() );
		var mtlLoader = new THREE.MTLLoader();
		mtlLoader.setBaseUrl( 'models/' );
		mtlLoader.setPath( 'models/' );
		mtlLoader.load( m_path + '.mtl', function( materials ) {
			materials.preload();
			var objLoader = new THREE.OBJLoader();
			objLoader.setMaterials( materials );
			objLoader.setPath( 'models/' );
			objLoader.load( m_path + '.obj', function ( object ) {
				object.position.y = - 95;
				scene.add( object );
			}, onProgress, onError );

		});


		// renderer
        // mtlLoader.needsUpdate = true;

		renderer = new THREE.WebGLRenderer({antialias: true});
		renderer.setPixelRatio( window.devicePixelRatio );
		renderer.setSize( window.innerWidth, window.innerHeight );
		container.appendChild( renderer.domElement );

		stats = new Stats();
		stats.domElement.style.position = 'absolute';
		stats.domElement.style.top = '0px';
		stats.domElement.style.zIndex = 100;
		container.appendChild( stats.domElement );

		//
		window.addEventListener( 'resize', onWindowResize, false );

		render();
	}

    // Used to create points on scene
	function checkKey(e) {
		var event = window.event ? window.event : e;
		if(event.keyCode == 32){
            // var geometry = new THREE.BoxGeometry( 2, 1, 1 );
            // var material = new THREE.MeshBasicMaterial( { color: 0xffff00 } );
            // var mesh = new THREE.Mesh( geometry, material );
            // mesh.position.set(camera.position.x, camera.position.y, camera.position.z);
            // var point = {id:points.length, position:{x:camera.position.x, y:camera.position.y, z:camera.position.z}, neighbors:[]};
            // points.push(point);
            // console.log(JSON.stringify(points));
            // scene.add( mesh );
		}
	}

	function onWindowResize() {

		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();

		renderer.setSize( window.innerWidth, window.innerHeight );
	}



	//

	function animate() {

		requestAnimationFrame( animate );

		render();
		stats.update();
	}

	function render() {
		var delta = clock.getDelta();

		controls.update( delta );

		renderer.render( scene, camera );
	}

	</script>

</body>
</html>
